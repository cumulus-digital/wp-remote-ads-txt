(()=>{"use strict";const e=()=>{const e="cmls-remote-ads-txt".replace(/\-/g,"_"),t=window[e],a=document.getElementById("cmls-wp-remote-ads-txt");Array.from(document.getElementsByClassName("cache-message")).forEach((e=>{const a=e.querySelector("a.cmls-remote-ads-rebuild-cache");a&&a.addEventListener("click",(async e=>{if(e.preventDefault(),e.target.classList.contains("loading"))return!1;const a=e.target.parentNode.parentNode.querySelector(".cache-time"),n=e.target.getAttribute("data-handle");if(n&&t?.rebuild_actions?.[n]&&a){const o=new FormData;o.append("action",t.rebuild_actions[n]),o.append("nonce",t.nonce),a.style.opacity=.5,e.target.classList.add("loading","disabled"),e.target.blur(),await fetch(t.ajaxurl,{method:"POST",credentials:"same-origin",cache:"no-cache",body:o}).then((e=>e.json())).then((e=>{a.innerText=e.data.msg,t.nonce=e.data.nonce})).catch((e=>{console.error(e)})).finally((()=>{a.style.opacity=1,e.target.classList.remove("loading","disabled")}))}}))}));const n=async()=>{const e=new FormData;e.append("action",t.rebuild_actions.get_mtime),e.append("nonce",t.nonce),await fetch(t.ajaxurl,{method:"POST",credentials:"same-origin",cache:"no-cache",body:e}).then((e=>e.json())).then((e=>{const a=e.data.msg;a&&Object.keys(a).forEach((e=>{const t=document.querySelector(`.cache-message.${e} .cache-time`);t&&(t.innerText=a[e])})),t.nonce=e.data.nonce,setTimeout((()=>{n()}),6e5)})).catch((e=>{console.error(e)}))};if(setTimeout((()=>{n()}),1e3),document.querySelector(".cmls-remote-ads-rebuild-cron").addEventListener("click",(async e=>{if(e.preventDefault(),e.target.classList.contains("loading"))return!1;const a=new FormData;a.append("action",t.rebuild_actions.rebuild_cron),a.append("nonce",t.nonce),e.target.style.opacity=.5,e.target.classList.add("loading","disabled"),e.target.blur(),await fetch(t.ajaxurl,{method:"POST",credentials:"same-origin",cache:"no-cache",body:a}).then((e=>e.json())).then((e=>{t.nonce=e.data.nonce})).catch((e=>{console.error(e)})).finally((()=>{e.target.style.opacity=1,e.target.classList.remove("loading","disabled")}))})),setTimeout((function(){const e=document.querySelector("#setting-error-settings_updated.notice-success .notice-dismiss");e&&e.click()}),8e3),a){const e={isDirty:!1,initialValues:{},fields:Array.from(a.elements)},n=e=>!(!e.name||["submit","button","hidden"].includes(e.type.toLowerCase())),r=t=>{e.fields.some((t=>!!n(t)&&(e.initialValues[t.name]!==t.value?(e.isDirty=!0,!0):void(e.isDirty=!1))))};e.fields.forEach((t=>{if(!n(t))return!1;e.initialValues[t.name]=t.value,t.addEventListener("change",r),t.addEventListener("input",r)})),window.onbeforeunload=()=>{if(e.isDirty)return"You have unsaved changes! Are you sure you want to abandon them?"};var o=!1;const c=async n=>{if(n.preventDefault(),o)return;o=!0;const r=Array.from(document.querySelectorAll("input.remote-url"));let i=!1,s=n.target.querySelector('input.button-primary[type="submit"]');if(s.value,s.value="Validating...",s.disabled=!0,await Promise.all(r.map((async e=>{if(e.value){const a=new FormData;a.append("action",t.rebuild_actions.validate_remote),a.append("url",e.value),a.append("nonce",t.nonce),await fetch(t.ajaxurl,{method:"POST",credentials:"same-origin",cache:"no-cache",body:a}).then((e=>e.json())).then((a=>{if(!a.success){i=!0;let t=e.closest(".error-msg");t||(t=document.createElement("label"),t.setAttribute("for",e.id),t.classList.add("error-msg","error"),e.after(t)),t.innerText=a.data.msg,e.classList.add("error"),e.scrollIntoView()}t.nonce=a.data.nonce})).catch((e=>{console.error(e)})).finally((()=>{}))}}))),o=!1,i)return s.value="Fix the errors and try again!",s.disabled=!1,!1;s.value="Submitting form...",e.isDirty=!1,a.removeEventListener("submit",c),a.submit()};a.addEventListener("submit",c)}};["complete","loaded","interactive"].includes(document.readyState)?e():window.addEventListener("DOMContentLoaded",e)})();